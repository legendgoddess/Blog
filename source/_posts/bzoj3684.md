---
title: BZOJ3684 大朋友和多叉树 
dates: 2022-02-22 14:55:30
tags:
  - 生成函数
  - 数论
  - 反演
  - Dp
categories
  - BZOJ题解
---

<h3><center>BZOJ3684 大朋友和多叉树</center></h3>

首先考虑一下如果进行 $\tt Dp$ 的话需要如何进行转移。

- 考虑单独增加一个节点。

- 考虑通过题目给出的一个度数进行合并。

但是发现转移的话可能会产生一个环，那么我们就尝试使用$\tt\color{red}\text{生成函数}$，设 $F(x)$ 表示最终答案的生成函数。

那么我们根据之前的转移就可以得到方程：

$$
F(x) = x + \sum_{i \in Deg} F^i(x) 
$$

我们考虑移项得到 $F(x) - \sum_{i \in Deg} F^i(x) = x$ 我们注意到这个最后这个 $x$ 貌似可以进行拉格朗日反演。

设 $G(x) = x - \sum_{i \in Deg} x^i$ 那么我们就有 $G(F(x)) = x$。带入反演的式子得到：

$$
[x^n]F(x) = \frac{1}{n}[x^{-1}]\frac{1}{G^n(x)}
$$

那么问题来了我们现在多项式能做是表示整式，显然这个 $G(x)$ 是没有逆元的。

> 因为 $G(0) = 0$。

那么这个就一定是一个分式。我们考虑将其用整式表示出来，不妨设其前缀 $0$ 的个数为 $d$ ：

$$
\begin{aligned}
\frac{1}{G(x)} &= \frac{1}{\frac{G(x)}{x^d}} \times \frac{1}{x^d}
\end{aligned}
$$

那么左边的部分显然是有逆元的，我们对比一下两个式子：

$$
\frac{1}{G^n(x)}\\
(\frac{x^d}{G(x)})^n
$$



显然下面的式子本质上就是向右平移了 $dn$ 个 $x$ 那么我们的答案也要相应的偏移 $dn$。也就是有如下式子：

$$
[x^{-1}]\frac{1}{G^n(x)} = [x^{dn - 1}](\frac{x^d}{G(x)})^n
$$

那么这题就做完了，我们总结一下式子：

$$
[x^n]F(x) = \frac{1}{n}[x^{dn - 1}](\frac{1}{\frac{G(x)}{x^d}}) ^ n
$$

> 实现的时候先将 $G(x)$ 平移记录平移值即可。

```cpp

```
